{"version":3,"names":["WebCamera","async","parentElement","direction","drawImageCb","this","resetCamera","elVideo","createVideo","canvas","createCanvas","appendChild","initWebcamToVideo","renderToCanvas","stream","_b","_a","getVideoTracks","forEach","track","stop","removeTrack","srcObject","takePicture","camera","inputFileFromWebcamCss","InputFileFromWebcam","CameraDirection","Front","pic","pictureTaken","emit","__toogleFacingMode","onClickHandler","facingMode","Rear","facingModeChanged","componentWillMount","initCamera","el","render","h","Host","style","height","width","name"],"sources":["src/utils/camera.ts","src/components/input-file-from-webcam/input-file-from-webcam.css?tag=input-file-from-webcam&encapsulation=shadow","src/components/input-file-from-webcam/input-file-from-webcam.tsx"],"sourcesContent":["import { createVideo, createCanvas, CameraDirection, initWebcamToVideo, renderToCanvas, takePicture } from \"./camera.service\";\n\n\n\ninterface SuperCamera {\n    initCamera(parentElement: HTMLElement, direction: CameraDirection, drawImageCb: Function): Promise<HTMLCanvasElement>,\n    takePicture(): Promise<Blob>,\n    resetCamera(): void,\n}\n\n\n\nexport class WebCamera implements SuperCamera {\n\n    private elVideo: HTMLVideoElement;\n    private stream: MediaStream;\n    private canvas: HTMLCanvasElement;\n\n\n    public async initCamera( parentElement: HTMLElement, direction: CameraDirection, drawImageCb: Function = null) {\n        \n        this.resetCamera();\n\n        if ( !this.elVideo ) {\n            this.elVideo = createVideo()\n        }\n\n        if ( !this.canvas ) {\n            this.canvas = createCanvas(parentElement)\n            parentElement.appendChild(this.canvas)\n        }\n        \n        initWebcamToVideo(this.elVideo, direction)\n\n        renderToCanvas(this.canvas, this.elVideo, drawImageCb)\n\n        return this.canvas\n    }\n\n\n    public resetCamera() {\n        if (this.stream) this.stream?.getVideoTracks()?.forEach(track => {\n            track?.stop()\n            this.stream?.removeTrack(track)\n        });\n        if (this.elVideo) this.elVideo.srcObject = null;\n    }\n\n    public async takePicture(): Promise<File> {\n        return await takePicture(this.canvas)\n\n    }\n\n}\n\n\nexport const camera = new WebCamera()\n",":host {\n  display: inline-block;\n  width: 100px;\n  filter: drop-shadow(2px 4px 6px black);\n  border: #5a5252 1px solid;\n  border-style: groove;\n}\n\n\nvideo {\n  display: none;\n}\n\ncanvas {\n  width: 100%;\n  height: 100%;\n}","import { Component, Host, h, Method, Listen, Prop, Event, EventEmitter, Element } from '@stencil/core';\nimport { camera } from '../../utils/camera';\nimport { CameraDirection } from '../../utils/camera.service';\n\n\n@Component({\n  tag: 'input-file-from-webcam',\n  styleUrl: 'input-file-from-webcam.css',\n  shadow: true,\n})\nexport class InputFileFromWebcam {\n\n\n  @Element() el: HTMLElement;\n\n\n  @Prop({reflect: true, mutable: true}) width?: number = 460\n  @Prop({reflect: true, mutable: true}) height?: number = 460\n\n  /**\n   * FacingModel optiones following https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints/facingMode#value\n   */\n  @Prop({ mutable: true, reflect: true }) facingMode?: CameraDirection = CameraDirection.Front\n\n  /**\n   * you can pass a function and override the canvas.drawImage function so you\n   * can change the image adding filters or any kind of magin in your image\n   * \n   * you just need to crear a function with all canvas.-drawImage arguments\n   * \n   * here you have the list of vars you get: videoElement, left, top, imgSize, imgSize, 0,0, canvas.width, canvas.height\n   */\n  @Prop() drawImageCb?: Function = null\n\n  @Method()\n  async takePic(): Promise<Blob> {\n    // show a prompt\n    const pic = await camera.takePicture()\n    this.pictureTaken.emit(pic);\n    return pic\n  }\n\n  @Method()\n  async resetCamera(): Promise<void> {\n    // show a prompt\n    camera.resetCamera()\n  }\n\n  @Method()\n  async toggleCamera(): Promise<void>{\n    this.__toogleFacingMode()\n  }\n\n\n  @Event({\n    eventName: 'pictureTaken',\n    composed: true,\n    cancelable: false,\n    bubbles: true,\n  }) pictureTaken: EventEmitter<Blob>;\n\n  @Event({\n    eventName: 'facingModeChanged',\n    composed: true,\n    cancelable: false,\n    bubbles: true,\n  }) facingModeChanged: EventEmitter<CameraDirection>;\n\n\n\n  @Listen('click')\n  onClickHandler() {\n    this.__toogleFacingMode()\n  }\n\n \n\n  /**\n   * Toogle webcam, for example in mobile show front or back camera\n   * you can block this behaviour by setting the facingMode Property\n   */\n  private __toogleFacingMode() {\n    // only change if no facinMode property was set\n    this.facingMode = (this.facingMode != CameraDirection.Front) ? CameraDirection.Front : CameraDirection.Rear\n    this.facingModeChanged.emit( this.facingMode   )\n  }\n\n \n\n  componentWillMount() {\n   \n  }\n  \n  async componentDidRender() {\n    camera.initCamera( this.el, CameraDirection.Front, this.drawImageCb );\n  }\n\n  async disconnectedCallback() {\n    camera.resetCamera()\n  }\n\n  render() {\n    return (\n      <Host style={{height: this.height+\"px\", width: this.width+\"px\"}}>\n\n        <slot name='before'></slot>\n        \n        <slot></slot>\n\n        <slot name='after'></slot>\n      </Host>\n    );\n  }\n\n}\n"],"mappings":"wIAYaA,EAOFC,iBAAkBC,EAA4BC,EAA4BC,EAAwB,MAErGC,KAAKC,cAEL,IAAMD,KAAKE,QAAU,CACjBF,KAAKE,QAAUC,G,CAGnB,IAAMH,KAAKI,OAAS,CAChBJ,KAAKI,OAASC,EAAaR,GAC3BA,EAAcS,YAAYN,KAAKI,O,CAGnCG,EAAkBP,KAAKE,QAASJ,GAEhCU,EAAeR,KAAKI,OAAQJ,KAAKE,QAASH,GAE1C,OAAOC,KAAKI,M,CAITH,c,QACH,GAAID,KAAKS,QAAQC,GAAAC,EAAAX,KAAKS,UAAM,MAAAE,SAAA,SAAAA,EAAEC,oBAAgB,MAAAF,SAAA,SAAAA,EAAEG,SAAQC,I,MACpDA,IAAK,MAALA,SAAK,SAALA,EAAOC,QACPJ,EAAAX,KAAKS,UAAM,MAAAE,SAAA,SAAAA,EAAEK,YAAYF,EAAM,IAEnC,GAAId,KAAKE,QAASF,KAAKE,QAAQe,UAAY,I,CAGxCrB,oBACH,aAAasB,EAAYlB,KAAKI,O,EAO/B,MAAMe,EAAS,IAAIxB,ECxD1B,MAAMyB,EAAyB,8K,MCUlBC,EAAmB,M,oIAMyB,I,YACC,I,gBAKeC,EAAgBC,M,iBAUtD,I,CAGjC3B,gBAEE,MAAM4B,QAAYL,EAAOD,cACzBlB,KAAKyB,aAAaC,KAAKF,GACvB,OAAOA,C,CAIT5B,oBAEEuB,EAAOlB,a,CAITL,qBACEI,KAAK2B,oB,CAqBPC,iBACE5B,KAAK2B,oB,CASCA,qBAEN3B,KAAK6B,WAAc7B,KAAK6B,YAAcP,EAAgBC,MAASD,EAAgBC,MAAQD,EAAgBQ,KACvG9B,KAAK+B,kBAAkBL,KAAM1B,KAAK6B,W,CAKpCG,qB,CAIApC,2BACEuB,EAAOc,WAAYjC,KAAKkC,GAAIZ,EAAgBC,MAAOvB,KAAKD,Y,CAG1DH,6BACEuB,EAAOlB,a,CAGTkC,SACE,OACEC,EAACC,EAAI,CAACC,MAAO,CAACC,OAAQvC,KAAKuC,OAAO,KAAMC,MAAOxC,KAAKwC,MAAM,OAExDJ,EAAA,QAAMK,KAAK,WAEXL,EAAA,aAEAA,EAAA,QAAMK,KAAK,U"}