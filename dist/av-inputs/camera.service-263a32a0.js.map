{"file":"camera.service-263a32a0.js","mappings":"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","names":[],"sources":["src/utils/camera.service.ts"],"sourcesContent":["import { BoundingBox } from \"@mediapipe/tasks-vision\";\n\nexport enum CameraDirection {\n    Rear = \"REAR\",\n    Front = \"FRONT\"\n}\n\n/**\n * Crea un HTMLVideoElement en el parentElement dado, siempre y cuando no exista\n * @param parentElement \n */\nexport  function createVideo(): HTMLVideoElement {\n        \n    // no existe, lo creo\n    const video = document.createElement(\"video\")\n    video.autoplay = true;\n    video.style.display = \"none\"\n\n    return video\n}\n\n\n/**\n * Crea un HTMLCanvasElement en el parentElement dado, siempre y cuando no exista\n * @param parentElement \n */\nexport  function createCanvas( parentElement: HTMLElement ): HTMLCanvasElement {\n        \n    // no existe, lo creo\n    const canvas = document.createElement(\"canvas\")\n    canvas.width = parseInt( parentElement.getAttribute(\"width\") );\n    canvas.height = parseInt( parentElement.getAttribute(\"height\") );\n    return canvas\n}\n\nexport function videoToCanvas(video: HTMLVideoElement,box: BoundingBox): Promise<HTMLCanvasElement> {\n    return new Promise((resolve, reject) => {\n        try {\n            const canvas = document.createElement(\"canvas\")\n            const { originX, originY, width, height } = box\n\n            const upscaledW = width * 1.3\n            const upscaledH = height * 2\n\n\n            const finalW = upscaledW > upscaledH ? upscaledW : upscaledH\n            const finalH = upscaledW > upscaledH ? upscaledW : upscaledH\n\n            canvas.width = finalW;\n            canvas.height = finalH;\n\n            const ctx = canvas.getContext('2d');\n\n            const xMove = ((finalW - width)/2)\n            const yMove = ((finalH - height)/2)\n            ctx.drawImage(video, originX - xMove, originY - yMove, finalW, finalH, 0, 0, canvas.width, canvas.height);\n\n            resolve(canvas);\n        } catch (error) {\n            reject(error);\n        }\n      });\n}\n\n\nexport function videoToBlob(video: HTMLVideoElement, box?: BoundingBox, compression: number = 0.85): Promise<Blob> {\n    return new Promise((resolve, reject) => {\n        try {\n            \n            videoToCanvas(video, box).then( canvas => {\n                canvas.toBlob( (blob) => {\n                    resolve(blob);\n                }, \"image/jpeg\", compression)\n            })\n        } catch (error) {\n            reject(error);\n        }\n      });\n    \n\n}\n\nexport function renderToCanvas( canvas, video, drawImageCb?: Function|null ): number {\n\n    let ctx = canvas.getContext('2d');\n\n    let imgWidth = video.videoWidth;\n    let imgHeight = video.videoHeight;\n\n    var imgSize = Math.min(imgWidth, imgHeight);\n    // The following two lines yield a central based cropping.\n    // They can both be amended to be 0, if you wish it to be\n    // a left based cropped image.\n    var left = (imgWidth - imgSize) / 2;\n    var top = (imgHeight - imgSize) / 2;\n\n\n    if ( drawImageCb ) {\n        drawImageCb.call(this, ctx, video, left, top, imgSize, imgSize, 0,0, canvas.width, canvas.height)\n    } else {\n        ctx.drawImage(video, left, top, imgSize, imgSize, 0,0, canvas.width, canvas.height);\n    }\n\n\n    return requestAnimationFrame(() => renderToCanvas( canvas, video, drawImageCb) );\n\n}\n\n\nexport async function takePicture( canvas, compression = 0.85 ): Promise<File> {\n    return new Promise((resolve, reject) => {\n        try {\n            canvas.toBlob( (blob) => {\n                const filename = \"pic_\" + Math.abs( Math.round( Math.random() * 1000))\n                var file = new File([blob], filename, {type: \"image/jpeg\"});\n                resolve(file);\n            }, \"image/jpeg\", compression)\n        } catch (error) {\n            reject(error);\n        }\n      });\n}\n\n\nexport function initWebcamToVideo(video, direction: CameraDirection = CameraDirection.Front) {\n    return new Promise((resolve, reject) => {\n\n        if (navigator.mediaDevices.getUserMedia) {\n            const facingMode = (direction == CameraDirection.Front) ? \"user\": \"environment\"\n    \n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { min: 200 },\n                    height: { min: 200 },\n                    facingMode: facingMode\n                }\n            })\n            .then((stream) => {\n                video.srcObject = stream;\n                resolve(stream);\n            })\n            .catch(function (err0r) {\n                reject(err0r);\n            });\n        }\n    });\n}"],"version":3}