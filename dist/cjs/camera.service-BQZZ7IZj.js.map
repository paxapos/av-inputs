{"version":3,"file":"camera.service-BQZZ7IZj.js","sources":["src/utils/camera.service.ts"],"sourcesContent":["import { BoundingBox } from \"@mediapipe/tasks-vision\";\n\nexport enum CameraDirection {\n    Rear = \"REAR\",\n    Front = \"FRONT\"\n}\n\n/**\n * Crea un HTMLVideoElement en el parentElement dado, siempre y cuando no exista\n * @param parentElement\n */\nexport  function createVideo(): HTMLVideoElement {\n\n    // no existe, lo creo\n    const video = document.createElement(\"video\")\n    video.autoplay = true;\n    video.style.display = \"none\"\n\n    return video\n}\n\n\n/**\n * Crea un HTMLCanvasElement en el parentElement dado, siempre y cuando no exista\n * @param parentElement\n */\nexport  function createCanvas( parentElement: HTMLElement ): HTMLCanvasElement {\n\n    // no existe, lo creo\n    const canvas = document.createElement(\"canvas\")\n    canvas.width = parseInt( parentElement.getAttribute(\"width\") );\n    canvas.height = parseInt( parentElement.getAttribute(\"height\") );\n    return canvas\n}\n\nexport function videoToCanvas(video: HTMLVideoElement,box: BoundingBox): Promise<HTMLCanvasElement> {\n    return new Promise((resolve, reject) => {\n        try {\n            const canvas = document.createElement(\"canvas\")\n            const { originX, originY, width, height } = box\n\n            const upscaledW = width * 1.3\n            const upscaledH = height * 2\n\n\n            const finalW = upscaledW > upscaledH ? upscaledW : upscaledH\n            const finalH = upscaledW > upscaledH ? upscaledW : upscaledH\n\n            canvas.width = finalW;\n            canvas.height = finalH;\n\n            const ctx = canvas.getContext('2d');\n\n            const xMove = ((finalW - width)/2)\n            const yMove = ((finalH - height)/2)\n            ctx.drawImage(video, originX - xMove, originY - yMove, finalW, finalH, 0, 0, canvas.width, canvas.height);\n\n            resolve(canvas);\n        } catch (error) {\n            reject(error);\n        }\n      });\n}\n\n\nexport function videoToBlob(video: HTMLVideoElement, box?: BoundingBox, compression: number = 0.85): Promise<Blob> {\n    return new Promise((resolve, reject) => {\n        try {\n\n            videoToCanvas(video, box).then( canvas => {\n                canvas.toBlob( (blob) => {\n                    resolve(blob);\n                }, \"image/jpeg\", compression)\n            })\n        } catch (error) {\n            reject(error);\n        }\n      });\n\n\n}\n\nexport function renderToCanvas( canvas, video, drawImageCb?: Function|null ): number {\n\n    let ctx = canvas.getContext('2d');\n\n    let imgWidth = video.videoWidth;\n    let imgHeight = video.videoHeight;\n\n    var imgSize = Math.min(imgWidth, imgHeight);\n    // The following two lines yield a central based cropping.\n    // They can both be amended to be 0, if you wish it to be\n    // a left based cropped image.\n    var left = (imgWidth - imgSize) / 2;\n    var top = (imgHeight - imgSize) / 2;\n\n\n    if ( drawImageCb ) {\n        drawImageCb.call(this, ctx, video, left, top, imgSize, imgSize, 0,0, canvas.width, canvas.height)\n    } else {\n        ctx.drawImage(video, left, top, imgSize, imgSize, 0,0, canvas.width, canvas.height);\n    }\n\n\n    return requestAnimationFrame(() => renderToCanvas( canvas, video, drawImageCb) );\n\n}\n\n\nexport async function takePicture( canvas, compression = 0.85 ): Promise<File> {\n    return new Promise((resolve, reject) => {\n        try {\n            canvas.toBlob( (blob) => {\n                const filename = \"pic_\" + Math.abs( Math.round( Math.random() * 1000))\n                var file = new File([blob], filename, {type: \"image/jpeg\"});\n                resolve(file);\n            }, \"image/jpeg\", compression)\n        } catch (error) {\n            reject(error);\n        }\n      });\n}\n\n\nexport function initWebcamToVideo(video: HTMLVideoElement, direction: CameraDirection = CameraDirection.Front): Promise<MediaStream> {\n    return new Promise((resolve, reject) => {\n\n        if (navigator.mediaDevices.getUserMedia) {\n            const facingMode = (direction == CameraDirection.Front) ? \"user\": \"environment\"\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { min: 200 },\n                    height: { min: 200 },\n                    facingMode: facingMode\n                }\n            })\n            .then((stream) => {\n                video.srcObject = stream;\n                resolve(stream);\n            })\n            .catch(function (err0r) {\n                reject(err0r);\n            });\n        }\n    });\n}\n"],"names":["CameraDirection"],"mappings":"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"}